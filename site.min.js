/*! project3 2018-05-02 */

function Card(t){this.SAFE_SPACES=[0,60,61,62,63,64,65],this.cardNum=t}function Deck(){this.deck=[],this.deckSize=0,this.DECK_LIST=[1,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,7,7,7,7,8,8,8,8,10,10,10,10,11,11,11,11,12,12,12,12,13,13,13,13],this.card_pop=null}function Game(){this.SIZE=16,this.DRAW=0,this.MOVE=1,this.DRAW_BUTTON=[4,6],this.SKIP_BUTTON=[4,9],this.players=[null,null,null,null],this.deck=new Deck,this.game_grid=[],this.currentPlayer=0,this.currentCard=null,this.turnPhase=this.DRAW,this.playerNum=0,this.initializeGrid(),this.deck.generate_game_deck()}function GameView(t){((this.game=t).view=this).game_div=$("div.game"),this.name_form=$("form.name");var n=this;this.name_form.submit(function(t){t.preventDefault();var e=$(".gripe");e.text("");for(var i=0,r=1;r<=4;r++){var o=$("#p"+r).val();""!==o&&(n.game.addPlayer(r-1,o),i+=1)}i<2?(e.text("Please enter at least 2 players!"),n.game.clearPlayers()):(n.name_form.hide(),n.build_board(),n.game_div.show())})}function Minion(t,e,i){switch(this.POSSIBLEPOSITIONS=0,this.SLIDE=[13,14,15,21,22,23,24,28,29,30,36,37,38,39,43,44,45,51,52,53,54],this.SLIDE_START=[13,21,28,36,43,51],this.position=0,this.game=i,this.color=t,this.homeBase=e,t){case"blue":this.image="images/minion-blue.png";break;case"green":this.image="images/minion-green.png";break;case"red":this.image="images/minion-red.png";break;case"yellow":this.image="images/minion-yellow.png"}}function Player(t,e,i){this.NUM_MINIONS=3,this.name=t,this.color=e,this.minions=[];for(var r=0;r<this.NUM_MINIONS;r++)this.minions.push(new Minion(e,r,i));this.game=i,this.bummer=!1}Card.prototype.getCardNum=function(){return this.cardNum},Card.prototype.playCard=function(t,e){var i=e[0],r=e[1],o=t.getPositionFromArray(r,i);switch(this.cardNum){case 1:if(66===t.getPosition()){if(1===o)return t.move(-65),!0}else if(t.getPosition()<65&&o===t.getPosition()+1)return t.move(1),!0;break;case 2:if(66===t.getPosition()){if(2===o)return t.move(-64),!0}else if(0===t.getPosition()){if(1===o)return t.move(1),!0}else if(t.getPosition()<64&&o===t.getPosition()+2)return t.move(2),!0;break;case 3:if(66===t.getPosition()){if(3===o)return t.move(-63),!0}else if(t.getPosition()<63&&0<t.getPosition()&&o===t.getPosition()+3)return t.move(3),!0;break;case 4:if(66===t.getPosition()){if(56===o)return t.move(-10),!0}else if(4===t.getPosition()){if(66===o)return t.move(62),!0}else if(t.getPosition()<4&&0<t.getPosition()){if(o===t.getPosition()+56)return t.move(56),!0}else if(0!==t.getPosition()&&o===t.getPosition()-4)return t.move(-4),!0;break;case 5:if(66===t.getPosition()){if(5===o)return t.move(-61),!0}else if(t.getPosition()<61&&0<t.getPosition()&&o===t.getPosition()+5)return t.move(5),!0;break;case 7:if(66===t.getPosition()){if(7===o)return t.move(-59),!0}else if(t.getPosition()<59&&0<t.getPosition()&&o===t.getPosition()+7)return t.move(7),!0;break;case 8:if(66===t.getPosition()){if(8===o)return t.move(-58),!0}else if(t.getPosition()<58&&0<t.getPosition()&&o===t.getPosition()+8)return t.move(8),!0;break;case 10:if(66===t.getPosition()){if(10===o)return t.move(-56),!0;if(59===o)return t.move(-7),!0}else if(1===t.getPosition()){if(66===o)return t.move(65),!0}else{if(1<t.getPosition()&&o===t.getPosition()-1)return t.move(-1),!0;if(t.getPosition()<56&&0<t.getPosition()&&o===t.getPosition()+10)return t.move(10),!0}break;case 11:if(66===t.getPosition()){if(11===o)return t.move(-55),!0;if(58===o)return t.move(-8),!0}else if(2===t.getPosition()){if(66===o)return t.setPosition(66),!0}else if(1===t.getPosition()){if(59===o)return t.setPosition(59),!0}else{if(2<t.getPosition()&&o===t.getPosition()-2)return t.move(-2),!0;if(t.getPosition()<55&&0<t.getPosition()&&o===t.getPosition()+11)return t.move(11),!0}break;case 12:if(66===t.getPosition()){if(12===o)return t.move(-54),!0}else if(t.getPosition()<54&&0<t.getPosition()&&o===t.getPosition()+12)return t.move(12),!0;break;case 13:if(0===t.getPosition()&&-1===$.inArray(o,this.SAFE_SPACES)&&null!==t.game.getMinion({r:i,c:r})&&t.game.getMinion({r:i,c:r}).color!==t.color)return t.move(o),!0;break;default:return!1}},Deck.prototype.generate_game_deck=function(){for(var t=0;t<this.DECK_LIST.length;t++)this.addCard(this.DECK_LIST[t]);this.shuffleDeck()},Deck.prototype.drawCard=function(){return 0<this.deckSize?this.deckSize-=1:0===this.deckSize&&(this.generate_game_deck(),this.deckSize-=1),this.card_pop=this.deck[this.deck.length-1],this.deck.pop()},Deck.prototype.getDeck=function(){return this.deck},Deck.prototype.getDeckSize=function(){return this.deckSize},Deck.prototype.addCard=function(t){var e=new Card(t);this.deck.push(e),this.deckSize+=1},Deck.prototype.shuffleDeck=function(){this.shuffle(this.deck)},Deck.prototype.getCardPop=function(){return this.card_pop},Deck.prototype.shuffle=function(t){var e,i,r;for(r=t.length-1;0<r;r--)e=Math.floor(Math.random()*(r+1)),i=t[r],t[r]=t[e],t[e]=i;return t},Game.prototype.getDeck=function(){return this.deck},Game.prototype.getMinion=function(t){return this.game_grid[t.r][t.c]},Game.prototype.removeMinion=function(t){var e=t.r,i=t.c;this.game_grid[e][i]=null},Game.prototype.addMinion=function(t,e){var i=t.r,r=t.c,o=this.game_grid[i][r];null!==o&&o.bummer(),this.game_grid[i][r]=e},Game.prototype.Click=function(t){switch(this.turnPhase){case this.DRAW:t[0]===this.DRAW_BUTTON[0]&&t[1]===this.DRAW_BUTTON[1]&&(this.currentCard=this.deck.drawCard(),this.turnPhase=this.MOVE);break;case this.MOVE:(t[0]===this.SKIP_BUTTON[0]&&t[1]===this.SKIP_BUTTON[1]||this.players[this.currentPlayer].play(this.currentCard,t))&&(2!==this.currentCard.cardNum&&this.nextPlayer(),this.turnPhase=this.DRAW,this.currentCard=null)}this.view.update()},Game.prototype.initializeGrid=function(){for(var t=0;t<this.SIZE;t++){this.game_grid.push([]);for(var e=0;e<this.SIZE;e++)this.game_grid[t].push(null)}},Game.prototype.getPlayers=function(){return this.players},Game.prototype.addPlayer=function(t,e){this.players[t]=new Player(e,["yellow","green","red","blue"][t],this)},Game.prototype.clearPlayers=function(){this.players=[]},Game.prototype.getCurrentPlayer=function(){return this.players[this.currentPlayer]},Game.prototype.getCurrentCard=function(){return this.currentCard},Game.prototype.nextPlayer=function(){for(var t=null;null===t;)this.currentPlayer=(this.currentPlayer+1)%this.players.length,t=this.players[this.currentPlayer]},Game.prototype.get_winner=function(){for(var t=0;t<4;t++){var e=this.players[t];if(null!==e&&e.checkWin())return e}return null},GameView.prototype.build_board=function(){for(var t="",e=0;e<16;e++){t+='<div class="row">';for(var i=0;i<16;i++)t+='<div class="cell"><button></div>';t+="</div>"}t+='<image src="" alt="current card" height="308px" width="200px" class="card"><p class = "player_display">Player: <span id="current_player"></span>\n<image id="current_minion" src="" height="28px" width="28px" alt="current player\'s minion"></p>',$(".game").html(t);var r=this.game_div.children();for(e=0;e<16;e++){var o=r.eq(e).children();for(i=0;i<16;i++)this.install_listener(o.eq(i).children(),this.game,e,i)}this.update()},GameView.prototype.install_listener=function(t,e,i,r){t.click(function(){e.Click([i,r])})},GameView.prototype.update=function(){var t=this.game.get_winner();if(null!==t)return this.game_div.html("<form><h2>Congratulations!</h2><h2>"+t.name+" wins!</h2></form>"),this.game_div.css("background-image","none"),this.game_div.css("border","none"),this.game_div.css("height","auto"),void this.game_div.css("width","auto");var e=this.game.getCurrentCard(),i=$(".card");null===e?i.attr("src","images/card-back.png"):13===e.getCardNum()?i.attr("src","images/card-bummer.png"):i.attr("src","images/card-"+e.getCardNum()+".png");var r=this.game.getCurrentPlayer();null!==r||(this.game.nextPlayer(),r=this.game.getCurrentPlayer()),$("#current_player").html(r.getName()),$("#current_minion").attr("src","images/minion-"+r.getColor()+".png"),$(".cell").css("background-image","none");for(var o=this.game.getPlayers(),n=0;n<4;n++)if(player=o[n],null!==player)for(var s=player.getMinions(),a=0;a<3;a++){var h=s[a],c=h.getArrayFromPosition(),u=h.getColor();this.game_div.children().eq(c.r).children().eq(c.c).css("background-image","url(images/minion-"+u+".png)")}var g=this.game_div.children().eq(4);g.children().eq(6).css("background-image","url(images/draw.png)"),g.children().eq(9).css("background-image","url(images/end_turn.png)")},Minion.prototype.move=function(t){if(this.game.removeMinion(this.getArrayFromPosition()),this.position+=t,this.game.addMinion(this.getArrayFromPosition(),this),-1!==$.inArray(this.position,this.SLIDE_START))for(;-1!==$.inArray(this.position,this.SLIDE);)this.move(1)},Minion.prototype.bummer=function(){this.game.removeMinion(this.getArrayFromPosition(this.position)),this.position=0,this.game.addMinion(this.getArrayFromPosition(this.position),this)},Minion.prototype.getYellowArray=function(){return 0===this.position?{c:13,r:3+this.homeBase}:this.position<=12?{c:15,r:3+this.position}:this.position<=27?{c:15-(this.position-12),r:15}:this.position<=42?{c:0,r:15-(this.position-27)}:this.position<=57?{c:this.position-42,r:0}:this.position<=59?{c:15,r:this.position-57}:this.position<=64?{c:15-(this.position-59),r:2}:65===this.position?{c:8,r:1+this.homeBase}:66===this.position?{c:15,r:3}:[]},Minion.prototype.getArrayFromPosition=function(){var t=this.getYellowArray(),e=t.r,i=t.c;switch(this.color){case"yellow":return t;case"red":return{c:this.game.SIZE-i-1,r:this.game.SIZE-e-1};case"green":return{c:this.game.SIZE-e-1,r:i};case"blue":return{c:e,r:this.game.SIZE-i-1};default:return[]}},Minion.prototype.getYellowPosition=function(t,e){return 13===t&&3<=e&&e<=5?0:15===t&&4<=e&&e<=15?e-3:15===e&&1<=t&&t<=15?27-t:0===t&&1<=e&&e<=15?42-e:0===e&&0<=t&&t<=15?42+t:15===t&&0<=e&&e<=1?57+e:2===e&&10<=t&&t<=15?74-t:1<=e&&e<=3&&8===t?65:3===e&&15===t?66:[]},Minion.prototype.getPositionFromArray=function(t,e){switch(this.color){case"yellow":return this.getYellowPosition(t,e);case"red":return this.getYellowPosition(this.game.SIZE-t-1,this.game.SIZE-e-1);case"green":return this.getYellowPosition(e,this.game.SIZE-t-1);case"blue":return this.getYellowPosition(this.game.SIZE-e-1,t)}return[]},Minion.prototype.getPosition=function(){return this.position},Minion.prototype.setPosition=function(t){this.position=t},Minion.prototype.getState=function(){return this.state},Minion.prototype.setState=function(t){this.state=t},Minion.prototype.getImage=function(){return this.image},Minion.prototype.getGame=function(){return this.game},Minion.prototype.setGame=function(t){this.game=t},Minion.prototype.getColor=function(){return this.color},Player.prototype.play=function(t,e){for(var i=0;i<3;i++)if(t.playCard(this.minions[i],e))return!0;return!1},Player.prototype.getName=function(){return this.name},Player.prototype.getColor=function(){return this.color},Player.prototype.checkWin=function(){for(var t=0;t<this.NUM_MINIONS;t++)if(65!==this.minions[t].getPosition())return!1;return!0},Player.prototype.setName=function(t){this.name=t},Player.prototype.getMinions=function(){return this.minions},Player.prototype.isBummer=function(){return this.bummer};